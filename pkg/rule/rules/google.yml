rules:

- name: Google Client ID
  id: np.google.1

  pattern: '(?i)\b([0-9]+-[a-z0-9_]{32})\.apps\.googleusercontent\.com'

  categories: [api, identifier]

  examples:
  - "                 'clientID' : '231545488769-4d1mcev9vifvlncrern52id2pqqf5u5l.apps.googleusercontent.com',"
  - "                //$google_client_id     = '244082345999-o6m8f1pmb1e76tjfj9v7b96j31e53ps5.apps.googleusercontent.com';"
  - "      GOOGLE_OAUTH2_CLIENT_ID = '607830223128-4qgthc7ofdqce232dk690t5jgkm1ce33.apps.googleusercontent.com'"
  - '          $cordovaOauth.google("653512027492-5u9blotr1521fa0lo1172nhv4pmqgttq.apps.googleusercontent.com", ["email"]).then(function(result) {'


- name: Google OAuth Client Secret
  id: np.google.2

  pattern: |
    (?x)
    \b
    (GOCSPX-[a-zA-Z0-9_-]{28})
    (?:[^a-zA-Z0-9_-] | $)

  categories: [api, secret]

  examples:
  - 'const CLIENTSECRET = "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"'


- name: Google OAuth Client Secret
  id: np.google.3

  pattern: |
    (?x)(?i)
    client.?secret .{0,10}
    \b
    ([a-z0-9_-]{24})
    (?: [^a-z0-9_-] |$)

  categories: [api, fuzzy, secret]

  examples:
  - '"client_secret":"aaaaaaaaaaaaaaaaaaaaaaa-"'
  - "                 //$google_client_secret = 'fnhqAakzWrX-mtFQ4PRdMoy0';"
  - "                'clientSecret' : 'Ufvuj-d6alhwGKvvLh_8Nq0K'"


- name: Google OAuth Access Token
  id: np.google.4

  pattern: |
    (?x)
    \b
    (ya29\.[0-9A-Za-z_-]{20,1024})
    (?: [^0-9A-Za-z_-]|$)  (?# Used instead of `\b` because that doesn't play well with trailing `-` )

  categories: [api, secret]

  examples:
  - |
      const setupCredentials = () => {
      const { encryptedData, iv } = encrypt({
        expiry_date: 1642441058842,
        access_token:
          'ya29.A0ARrdaM--PV_87ebjywDJpXKb77NBFJl16meVUapYdfNv6W6ZzCu947fNaPaRjbDbOIIcp6f49cMaX5ndK9TAFnKwlVqz3nrK9nLKqgyDIhYsIq47smcAIZkK56SWPx3X3DwAFqRu2UPojpd2upWwo-3uJrod',
        // This token is linked to a test Google account (typebot.test.user@gmail.com)
        refresh_token:
          '1//039xWRt8YaYa3CgYIARAAGAMSNwF-L9Iru9FyuTrDSa7lkSceggPho83kJt2J29Ga91EhT1C6XV1vmo6bQS9puL_R2t8FIwR3gek',
      })
  - |
      -- Clear login if it's a new connection.
      --propertyTable.access_token = 'ya29.Ci_UA7aEsvT6-oVI8f96kvB6i8oO13WgdZUviLaCVtpEPYZqhQcQycR-u2X9xtmYGA'


- name: Google API Key
  id: np.google.5

  pattern: |
    (?x)
    \b
    (?P<key>AIza[0-9A-Za-z_-]{35})
    (?: [^0-9A-Za-z_-] | $ )

  categories: [api, secret]

  examples:
  - "  var DEVELOPER_KEY = 'AIzaSyB4sUaCes5bR_87qNb7eUVQN72_vv8mpbU';"
  - 'GOOGLE_API_KEY=AIzaSyBnAoaCesVUco4MXf4enYCVBg6ZnpY49N-'
  - "api_key: AIzaSyAKqPaCesigvvNNcRt_gL0A6cgx3ZB-kuQ"

  negative_examples:
  - "AIza-short"
  - "AIzaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
  - "GOOGLE_API_KEY=your-api-key-here"
  - "AIzaSyEXAMPLE_KEY_REPLACE_ME_1234567"

  description: |
    Google API key used for accessing Google Cloud APIs and services.
    Keys use the AIza prefix and are 39 characters total. An attacker
    with this key can access any Google API the key is authorized for,
    including Maps, YouTube, Cloud, Gemini, and other services. Keys
    are associated with Google Cloud projects for quota and billing.
    Google considers API keys semi-public identifiers, but they can
    still enable unauthorized API usage and incur billing charges.

  references:
  - https://cloud.google.com/docs/authentication/api-keys#securing
  - https://support.google.com/googleapi/answer/6310037
  # Note: the following reference claims that as far as Google is concerned, API keys that start with `AIza` are public.
  # Though other Google resources disagree.
  - https://bughunters.google.com/learn/invalid-reports/google-products/5222475159961600/understanding-api-key-leaks


- name: Google Cloud Storage Bucket
  id: np.gcs.1

  pattern: |
    (?x)
    (?: ^ | [\s/"'] | %2F )
    (
    (?: [a-zA-Z0-9_-]+ \. )+    (?# bucket name as subdomain )
    storage\.googleapis\.com
    )
    \b

  categories: [api, identifier]

  references:
  - https://cloud.google.com/storage/docs/request-endpoints

  examples:
  - 'c.storage.googleapis.com'
  - 'some-bucket.example.com.storage.googleapis.com'

  negative_examples:
  - 'https://storage.googleapis.com'


- name: Google Cloud Storage Bucket
  id: np.gcs.2

  pattern: |
    (?x)
    (?: ^ | [\s/"'] | %2F )
    (
    storage\.googleapis\.com
    /
    [a-zA-Z0-9_-]+ (?: \. [a-zA-Z0-9_-]+ )*    (?# bucket name as path )
    )
    (?: [^a-zA-Z0-9_-] | $ )                   (?# this instead of a \b anchor because that doesn't play nicely with `-` )

  categories: [api, identifier]

  references:
  - https://cloud.google.com/storage/docs/request-endpoints

  negative_examples:
  - 'c.storage.googleapis.com/some_object'
  - 'some-bucket.example.com.storage.googleapis.com/some_object'

  examples:
  - 'https://storage.googleapis.com/bucket_name/object_name'


# This matches an OAuth client ID followed closely by a client secret
- name: Google OAuth Credentials
  id: np.google.6

  pattern: |
    (?x)
    \b
    ([0-9]+-[a-z0-9_]{32}\.apps\.googleusercontent\.com)            (?# client ID )
    (?: (?s) .{0,40} )                                              (?# Arbitrary intermediate stuff; ?s causes . to match newlines )
    \b

    (?: (?i) client.?secret .{0,10} )?

    ( (?:GOCSPX-[a-zA-Z0-9_-]{28})                                  (?# prefixed client secret )
    | (?:\b [a-zA-Z0-9_-]{24})                                      (?# non-prefixed client secret )
    )

    (?:[^a-zA-Z0-9_-] | $)

  categories: [api, fuzzy, secret]

  examples:
  - |
      const CLIENT_ID = '304167046824-45h8no7j0s38akv998nivvb7i17ckqeh.apps.googleusercontent.com';
      const CLIENT_SECRET = '1QcFpNjHoAf4_XczYwhYicTl';

  - |
      public static GAPIS_CREDENTIALS = {
        // 1. Generate credentials: https://console.cloud.google.com/apis/
        // 2. Create OAuth page and set spreadsheets and drive.metadata.readonly scopes
        client_id: '132261435625-69ubohrvppjr9hcc5t9uighsb7j2cqhv.apps.googleusercontent.com',
        client_secret: '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',
        redirect_uri: `http://localhost:${Config.OAUTH_HTTP_PORT}/oauth2callback`
      };


- name: Google API Key (Base64 Encoded)
  id: np.google.7

  pattern: |
    (?x)
    (?P<key>QUl6YVN[A-Za-z0-9+/]{45}={0,2})
    (?:[^A-Za-z0-9+/=]|$)

  categories: [api, secret, encoded]

  examples:
  - '"googleMapsApiKey":"QUl6YVN5RHhZMXRlZjNWUHRfMTVtTzhKWnZiNzBSQVlIZlVLZW9z"'
  - 'API_KEY=QUl6YVN5QjRzVWFDZXM1YlJfODdxTmI3ZVVWUU43Ml92djhtcGJV'
  - 'config.apiKey = "QUl6YVN5QktxUGFDZXNpZ3Z2Tk5jUnRfZ0wwQTZjZ3gzWkIta3VR"'

  negative_examples:
  - 'QUl6YVN5-short'
  - 'not_base64_QUl6YVN5'

  description: |
    Base64-encoded Google API key. The original key uses the AIza prefix
    (39 characters total), which encodes to a 52-character base64 string
    starting with QUl6YVN. Applications sometimes encode API keys to
    obfuscate them or for transport encoding. An attacker can decode the
    key and use it to access Google Cloud APIs the key is authorized for.

  references:
  - https://cloud.google.com/docs/authentication/api-keys


- name: Google Maps API Key
  id: np.google.8

  pattern: |
    (?xi)
    (?:google|gmap|gmaps|maps)
    (?:.|[\n\r]){0,30}?
    (?:api)?
    (?:.|[\n\r]){0,10}?
    (?:key|token|secret)
    (?:.|[\n\r]){0,20}?
    (?P<key>AIza[0-9A-Za-z_-]{35})
    (?:[^0-9A-Za-z_-]|$)

  categories: [api, secret]

  examples:
  - 'googleMapsApiKey = "AIzaSyDxY1tef3VPt_15mO8JZvb70RAYHfUKeos"'
  - 'GOOGLE_MAPS_KEY=AIzaSyB4sUaCes5bR_87qNb7eUVQN72_vv8mpbU'
  - 'gmaps_api_key: AIzaSyAKqPaCesigvvNNcRt_gL0A6cgx3ZB-kuQ'
  - 'GMAP_KEY="AIzaSyBnAoaCesVUco4MXf4enYCVBg6ZnpY49N-"'

  negative_examples:
  - 'AIzaSyEXAMPLE_KEY_REPLACE_ME_1234567'
  - 'GOOGLE_MAPS_KEY=your-api-key-here'

  description: |
    Google Maps API key identified by context (variable names containing
    'google', 'gmap', 'gmaps', or 'maps' near 'key' or 'token'). These keys
    use the standard Google API format (AIza prefix, 39 characters) and can
    access Maps JavaScript API, Geocoding, Places, Directions, and other
    Maps Platform services. Exposed keys can lead to quota theft and billing
    charges on the key owner's Google Cloud account.

  references:
  - https://developers.google.com/maps/documentation/javascript/get-api-key
  - https://cloud.google.com/docs/authentication/api-keys
