rules:

- name: Azure Notification Hub Access Key
  id: np.azure.6

  pattern: |
    (?x)
    (?i)
    (?:["']?(?:hub)?(?:access|api|notification(?:Hub)?)Key|SharedAccessKey)["']?  (?# Key name with optional quotes)
    \s*[:\]=]\s*                                                                    (?# Separator: colon, equals, or bracket-equals)
    ["']?                                                                           (?# Optional opening quote)
    (?P<key>[A-Za-z0-9+/]{32,88}={0,2})                                            (?# Base64-encoded key: 32-88 chars + padding)
    ["']?                                                                           (?# Optional closing quote)

  references:
  - https://learn.microsoft.com/en-us/azure/notification-hubs/notification-hubs-push-notification-security
  - https://learn.microsoft.com/en-us/rest/api/notificationhubs/common-concepts
  - https://learn.microsoft.com/en-us/azure/notification-hubs/notification-hubs-nodejs-push-notification-tutorial

  categories:
  - api
  - fuzzy
  - secret

  description: >
    An Azure Notification Hub SharedAccessKey was found.
    Azure Notification Hubs is a scalable push notification engine for sending notifications to mobile platforms.
    This SharedAccessKey is used to generate Shared Access Signature (SAS) tokens for authenticating API requests.
    Depending on the associated access policy (DefaultListenSharedAccessSignature or DefaultFullSharedAccessSignature),
    an attacker with this key may be able to send push notifications, register devices, or manage the notification hub,
    potentially leading to unauthorized push notification spam, data exfiltration, or service disruption.

  examples:
  - |
      // JavaScript configuration
      const config = {
        "hubAccessKey": "TESTkibxXGWaxfM4mcrUf09T9J1IYqEXAMPLE7ttEw4="
      };

  - |
      # JSON configuration
      {
        "notificationHubKey": "SAMPLEabcdefGHIJKLMNOPQRSTUVWXYZ123456789+/w8="
      }

  - |
      // TypeScript configuration
      const hubApiKey = "DOCUMENTATIONabcXYZ12345678901234567890ABC+/==";

  - |
      # Azure connection settings
      {
        "SharedAccessKey": "EXAMPLEa1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8=="
      }

  negative_examples:
  # Placeholder examples
  - '"hubAccessKey": "YOUR_HUB_ACCESS_KEY_HERE"'
  - '"hubAccessKey": "<INSERT_KEY>"'
  - '"SharedAccessKey": "XXXXX"'
  - 'hubAccessKey = "[Shared Access key goes here]"'

  # Variable placeholders
  - 'const hubAccessKey = $KEY;'
  - 'hubAccessKey = process.env.HUB_ACCESS_KEY;'

  # Too short to be valid
  - '"hubAccessKey": "abc123"'
  - '"SharedAccessKey": "test"'

  # Documentation examples with marker words
  - '// Example: hubAccessKey = "YOUR_KEY_HERE"'
  - '# Set hubAccessKey to your actual key value'
