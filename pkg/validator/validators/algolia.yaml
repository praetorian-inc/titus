# pkg/validator/validators/algolia.yaml
# NOTE: Rules using this validator must define named capture groups in their regex patterns.
# Expected named groups:
# - kingfisher.algolia.1: "token" (e.g., (?P<token>[a-z0-9]{32}))
# - kingfisher.algolia.2: "appid" (e.g., (?P<appid>[A-Z0-9]{10}))
#
# Algolia uses two-part authentication:
# 1. Application ID (public identifier)
# 2. Admin API Key (secret credential)
#
# Validation endpoint: https://{APPID}-dsn.algolia.net/1/keys/{TOKEN}
# This endpoint retrieves the ACL (Access Control List) for the given API key
validators:
  - name: algolia-admin-api-key
    rule_ids:
      - kingfisher.algolia.1
    http:
      method: GET
      url: https://{{ appid }}-dsn.algolia.net/1/keys/{{ token }}
      headers:
        - name: X-Algolia-API-Key
          value: "{{ token }}"
        - name: X-Algolia-Application-Id
          value: "{{ appid }}"
      success_codes: [200]
      failure_codes: [401, 403, 404]
